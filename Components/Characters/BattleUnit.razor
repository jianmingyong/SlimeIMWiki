<a href="Characters/@Unit.Permalink" style="position: relative; width: 100px; height: 100px">
    <Div Position="Position.Absolute.Start.Is0.Top.Is0"
         Padding="Padding.Is1.OnX"
         TextSize="TextSize.ExtraSmall"
         TextColor="TextColor.Body"
         Style="z-index:4; background-color: #000000BB; transform: translateY(-100%)">
        @Unit.Name
    </Div>

    @if (Unit.HasEx || Unit.HasAttributeUnbound)
    {
        <Image Position="Position.Absolute.Start.Is0.Top.Is0" Width="Width.Is25"
               Source="image/rarity/badgeClassUp.png"
               Style="z-index: 3"></Image>
    }

    <Image Position="Position.Absolute.End.Is0.Top.Is0" Width="Width.Is25"
           Source="@GetAttributeIcon(Unit.Attribute)"
           Style="z-index: 3"></Image>

    <Image Position="Position.Absolute.End.Is0" Width="Width.Is25"
           Source="@GetAttackTypeIcon(Unit.AttackType)"
           Style="z-index: 3; top: 25%"></Image>

    <Div Position="Position.Absolute.Start.Is50.Top.Is50.Translate.Middle" Overflow="Overflow.Hidden"
         Style="z-index: 1; width: 99px; height: 99px">
        <Image Class="@("unitIcon facing" + Unit.Facing)" Position="Position.Absolute"
               Source="@Unit.Icon"
               Style="z-index: 1"></Image>
    </Div>

    @switch(Unit.InitialRarity)
    {
        case 3:
        {
            <Image Position="Position.Absolute.Start.Is0.Bottom.Is0" Width="Width.Is33"
                   Source="image/rarity/starCharaL3A.png"
                   Style="z-index: 3"></Image>

            <Image Position="Position.Absolute.Start.Is0.Top.Is0" Width="Width.Is100"
                   Source="image/rarity/frameMemberM3.png"
                   Style="z-index: 2"></Image>

            <Image Position="Position.Absolute.Start.Is0.Top.Is0" Width="Width.Is100"
                   Source="image/rarity/baseMemberM3.png"
                   Style="z-index: 0"></Image>
            break;
        }
        case 4:
        {
            <Image Position="Position.Absolute.Start.Is0.Bottom.Is0" Width="Width.Is33"
                   Source="image/rarity/starCharaL4A.png"
                   Style="z-index: 3"></Image>

            <Image Position="Position.Absolute.Start.Is0.Top.Is0" Width="Width.Is100"
                   Source="image/rarity/frameMemberM4.png"
                   Style="z-index: 2"></Image>

            <Image Position="Position.Absolute.Start.Is0.Top.Is0" Width="Width.Is100"
                   Source="image/rarity/baseMemberM4.png"
                   Style="z-index: 0"></Image>
            break;
        }
        case 5:
        {
            <Image Position="Position.Absolute.Start.Is0.Bottom.Is0" Width="Width.Is33"
                   Source="image/rarity/starCharaL5A.png"
                   Style="z-index: 3"></Image>

            <Image Position="Position.Absolute.Start.Is0.Top.Is0" Width="Width.Is100"
                   Source="image/rarity/frameMemberM5.png"
                   Style="z-index: 2"></Image>

            <Image Position="Position.Absolute.Start.Is0.Top.Is0" Width="Width.Is100"
                   Source="image/rarity/baseMemberM5.png"
                   Style="z-index: 0"></Image>
            break;
        }
        case 6:
        {
            @if (Unit.IsEx)
            {
                <Image Position="Position.Absolute.Start.Is0.Bottom.Is0" Width="Width.Is33"
                       Source="image/rarity/starCharaL6.png"
                       Style="z-index: 3"></Image>

                <Image Position="Position.Absolute.Start.Is0.Top.Is0" Width="Width.Is100"
                       Source="image/rarity/frameMemberM6u.png"
                       Style="z-index: 2"></Image>

                <Image Position="Position.Absolute.Start.Is0.Top.Is0" Width="Width.Is100"
                       Source="image/rarity/baseMemberM6u.png"
                       Style="z-index: 0"></Image>
            }
            else if (Unit.IsAttributeUnbound)
            {
                <Image Position="Position.Absolute.Start.Is0.Bottom.Is0" Width="Width.Is33"
                       Source="image/rarity/starCharaL6UP.png"
                       Style="z-index: 3"></Image>

                <Image Position="Position.Absolute.Start.Is0.Top.Is0" Width="Width.Is100"
                       Source="image/rarity/frameMemberM6up.png"
                       Style="z-index: 2"></Image>

                <Image Position="Position.Absolute.Start.Is0.Top.Is0" Width="Width.Is100"
                       Source="image/rarity/baseMemberM6up.png"
                       Style="z-index: 0"></Image>
            }
            break;
        }
    }
</a>

@code
{
    [Parameter]
    public required Models.BattleUnit Unit { get; set; }

    [Parameter]
    public required BattleAttribute[] BattleAttributes { get; set; }

    [Parameter]
    public required BattleAttackType[] BattleAttackTypes { get; set; }

    private string? GetAttributeIcon(string attribute)
    {
        return BattleAttributes.FirstOrDefault(ba => ba.Name.Equals(attribute, StringComparison.OrdinalIgnoreCase))?.Icon;
    }

    private string? GetAttackTypeIcon(string attackType)
    {
        return BattleAttackTypes.FirstOrDefault(type => type.Name.Equals(attackType, StringComparison.OrdinalIgnoreCase))?.Icon;
    }
}